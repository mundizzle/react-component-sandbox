<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Hello World</title>
<link rel="stylesheet" href="https://unpkg.com/codemirror@latest/lib/codemirror.css">
<link rel="stylesheet" href="https://unpkg.com/codemirror@latest/theme/solarized.css">
<link rel="stylesheet" href="https://unpkg.com/prismjs@latest/themes/prism-solarizedlight.css">
<style>
</style>
<script src="https://unpkg.com/codemirror@latest/lib/codemirror.js"></script>
<script src="https://unpkg.com/codemirror@latest/mode/javascript/javascript.js"></script>
<script src="https://unpkg.com/prismjs@latest/prism.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.6.12/beautify-html.js"></script>


<script src="https://unpkg.com/react@latest/dist/react.min.js"></script>
<script src="https://unpkg.com/react-dom@latest/dist/react-dom.min.js"></script>
<script src="https://unpkg.com/react-dom@latest/dist/react-dom-server.min.js"></script>
<script src="https://unpkg.com/babel-standalone@latest/babel.min.js"></script>
</head>
<body>

<textarea id="editor">
const name = 'mundi'
const App = () => {
  return <div>
    <h1>Cool Page</h1>
    <p>Hello <b>{name}</b></p>
  </div>
}
</textarea>

<pre><code class="language-html" id="markup"></code></pre>

<div id="root"></div>

<script>
function escapeHtml(html){
  var text = document.createTextNode(html);
  var div = document.createElement('div');
  div.appendChild(text);
  return div.innerHTML;
}

var editor = CodeMirror.fromTextArea(document.getElementById('editor'),{
  mode: 'javascript',
  lineNumbers: 'true',
  theme: 'solarized'
});

var config = { presets: ['es2015', 'stage-2', 'react'] }

var evaluate = function(){
  var value = editor.getValue()

  var renderValue = `
  ${value}
  ReactDOM.render(<App />, document.getElementById('root'))
  `;

  var renderToStaticMarkupValue = `
  ${value}
  ReactDOMServer.renderToStaticMarkup(<App />)
  `;

  var renderOutput = Babel.transform(
    renderValue, 
    config
  );
  eval(renderOutput.code)

  renderToStaticMarkupOutput = Babel.transform(
    renderToStaticMarkupValue, 
    config
  );

  document.getElementById('markup').innerHTML = escapeHtml(html_beautify(eval(renderToStaticMarkupOutput.code)))

}

editor.on('change', evaluate)

evaluate()

</script>
</body>
</html>
